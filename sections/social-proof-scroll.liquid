{% comment %}
  Social Proof Scrolling Grid

  An infinite scrolling social proof section with interactive bubbles
  showing customer testimonials, product highlights, and trust signals.
{% endcomment %}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .social-scroll-{{ section.id }} {
    --track-speed: {{ section.settings.scroll_speed }}s;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
    background: transparent;
  }

  /* --- TRACK --- */
  .social-scroll-{{ section.id }} .scroll-wrapper {
    display: flex;
    width: max-content;
    animation: marquee-{{ section.id }} var(--track-speed) linear infinite;
    will-change: transform;
    z-index: 1;
    align-items: center; /* Ensure vertical centering */
  }

  .social-scroll-{{ section.id }} .scroll-wrapper:hover {
    animation-play-state: paused;
  }

  @keyframes marquee-{{ section.id }} {
    from { transform: translateX(0); }
    to   { transform: translateX(-50%); }
  }

  /* --- ROW --- */
  .social-scroll-{{ section.id }} .flex-row {
    display: flex;
    gap: 1rem;                /* IMPORTANT */
    padding-right: 1rem;      /* buffer between duplicates */
  }

  /* --- BUBBLES --- */
  .social-scroll-{{ section.id }} .bubble {
    flex: 0 0 15rem;          /* 150px -> 15rem */
    height: 15rem;
    width: 15rem;
    border-radius: var(--media-radius);
    background: rgb(var(--color-button));
    border: 0.1rem solid rgba(var(--color-button-text), 0.1);
    color: rgb(var(--color-button-text));

    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 1.5rem;
    position: relative;
    cursor: pointer;
    box-sizing: border-box;
    transition: transform 0.2s ease, opacity 0.4s;
    box-shadow: var(--media-shadow-horizontal-offset) var(--media-shadow-vertical-offset) var(--media-shadow-blur-radius) rgba(var(--color-shadow), var(--media-shadow-opacity));
  }

  .social-scroll-{{ section.id }} .bubble.bursting {
    pointer-events: none;
    animation: burstEffect-{{ section.id }} 0.3s forwards;
  }

  @keyframes burstEffect-{{ section.id }} {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.15); opacity: 0.5; filter: blur(4px); }
    100% { transform: scale(0); opacity: 0; }
  }

  /* --- CONTENT STYLING --- */
  .social-scroll-{{ section.id }} .content-inner {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    width: 100%;
    overflow: hidden;
  }

  .social-scroll-{{ section.id }} .brand-name {
    font-size: 1rem;
    text-transform: uppercase;
    opacity: 0.7;
    margin-bottom: 0.2rem;
    font-family: var(--font-body-family);
    letter-spacing: 0.1rem;
  }

  .social-scroll-{{ section.id }} .user-tag {
    font-weight: bold;
    font-style: italic;
    font-size: 1.6rem;
    line-height: 1.2;
    font-family: var(--font-heading-family);
  }

  .social-scroll-{{ section.id }} .stat-line {
    opacity: 0.9;
    font-size: 1.2rem;
    font-family: var(--font-body-family);
  }

  .social-scroll-{{ section.id }} .proof-badge {
    display: none;
  }

  /* --- SECTION HEADER --- */
  .social-scroll-{{ section.id }} .section-header {
    text-align: center;
    margin-bottom: 4rem;
  }

  .social-scroll-{{ section.id }} .section-header p {
    color: rgba(var(--color-foreground), 0.75);
    font-family: var(--font-body-family);
  }
{%- endstyle -%}

<div class="social-scroll-{{ section.id }} color-{{ section.settings.color_scheme }} gradient section-{{ section.id }}-padding">
  {%- if section.settings.show_header -%}
    <div class="section-header">
      {%- if section.settings.heading != blank -%}
        <h2 class="title inline-richtext h1">{{ section.settings.heading }}</h2>
      {%- endif -%}
      {%- if section.settings.subheading != blank -%}
        <p>{{ section.settings.subheading }}</p>
      {%- endif -%}
    </div>
  {%- endif -%}

  <div class="scroll-wrapper" id="scrollWrapper-{{ section.id }}">
    {%- for i in (1..2) -%}
      <div class="flex-row">
        {%- for block in section.blocks -%}
          {%- if block.type == 'bubble' -%}
            {% render 'social-proof-bubble',
              title: block.settings.title,
              subtitle: block.settings.subtitle,
              badge: block.settings.badge,
              brand_name: section.settings.brand_name
            %}
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- endfor -%}
  </div>
</div>

<script>
  (function () {
    const sectionId = '{{ section.id }}';
    const scrollWrapper = document.getElementById('scrollWrapper-' + sectionId);

    function handlePop(el, e) {
      if (el.classList.contains('bursting') || el.style.opacity === '0') return;

      el.classList.add('bursting');

      setTimeout(() => {
        el.style.opacity = '0';
        el.style.pointerEvents = 'none';

        setTimeout(() => {
          el.classList.remove('bursting');
          el.style.opacity = '1';
          el.style.pointerEvents = 'auto';
        }, 4000);
      }, 500);
    }

    if (scrollWrapper) {
      scrollWrapper.onclick = (e) => {
        const b = e.target.closest('.bubble');
        if (b) handlePop(b, e);
      };
    }
  })();
</script>

{% schema %}
{
  "name": "Social Proof Scroll",
  "tag": "section",
  "class": "section",
  "max_blocks": 10,
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "checkbox",
      "id": "show_header",
      "label": "Show section header",
      "default": true
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Loved by Thousands"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Join our community of satisfied customers worldwide"
    },
    {
      "type": "header",
      "content": "Branding"
    },
    {
      "type": "text",
      "id": "brand_name",
      "label": "Brand name",
      "default": "Rumani Dhaage"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "range",
      "id": "scroll_speed",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "s",
      "label": "Scroll speed",
      "default": 30,
      "info": "Lower = faster"
    },
    {
      "type": "header",
      "content": "Section Sizing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "bubble",
      "name": "Bubble",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Title"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle",
          "default": "Subtitle"
        },
        {
          "type": "text",
          "id": "badge",
          "label": "Badge text",
          "default": "BADGE"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Social Proof Scroll",
      "blocks": [
        {
          "type": "bubble",
          "settings": {
            "title": "Silk Anarkali",
            "subtitle": "Sold in London",
            "badge": "POPULAR"
          }
        },
        {
          "type": "bubble",
          "settings": {
            "title": "@ananya_v",
            "subtitle": "Wearing 'Noor'",
            "badge": "INFLUENCER"
          }
        },
        {
          "type": "bubble",
          "settings": {
            "title": "Handcrafted",
            "subtitle": "Pure Banaras",
            "badge": "AUTHENTIC"
          }
        },
        {
          "type": "bubble",
          "settings": {
            "title": "Global Ship",
            "subtitle": "To 40+ Countries",
            "badge": "SHIPPING"
          }
        },
        {
          "type": "bubble",
          "settings": {
            "title": "100% Handwoven",
            "subtitle": "Certified Silk",
            "badge": "PURE"
          }
        }
      ]
    }
  ]
}
{% endschema %}
