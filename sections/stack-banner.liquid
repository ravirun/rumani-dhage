{% comment %}
  Stack Banner Section

  Displays cards in a sticky stack effect that scales as you scroll.
{% endcomment %}

<div class="stack-banner section-{{ section.id }}-padding">
  <div class="space space--small"></div>
  <div class="page-width">
    <div class="stack-banner__cards" id="stack-banner-{{ section.id }}">
      {%- for block in section.blocks -%}
        {% case block.type %}
          {% when 'card' %}
            <div
              class="stack-banner__card"
              data-index="{{ forloop.index0 }}"
              {{ block.shopify_attributes }}
            >
              <div class="stack-banner__card-inner">
                <div class="stack-banner__image-container">
                  {%- if block.settings.image != blank -%}
                    <img
                      class="stack-banner__image"
                      srcset="
                        {%- if block.settings.image.width >= 400 -%}{{ block.settings.image | image_url: width: 400 }} 400w,{%- endif -%}
                        {%- if block.settings.image.width >= 800 -%}{{ block.settings.image | image_url: width: 800 }} 800w,{%- endif -%}
                        {%- if block.settings.image.width >= 1200 -%}{{ block.settings.image | image_url: width: 1200 }} 1200w,{%- endif -%}
                        {%- if block.settings.image.width >= 1600 -%}{{ block.settings.image | image_url: width: 1600 }} 1600w,{%- endif -%}
                        {{ block.settings.image | image_url }} {{ block.settings.image.width }}w
                      "
                      src="{{ block.settings.image | image_url: width: 1200 }}"
                      sizes="100vw"
                      alt="{{ block.settings.image.alt | escape }}"
                      loading="lazy"
                      width="{{ block.settings.image.width }}"
                      height="{{ block.settings.image.height }}"
                    >
                  {%- else -%}
                    {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
                  {%- endif -%}
                  <div class="stack-banner__content">
                    {%- if block.settings.subheading != blank -%}
                      <p class="stack-banner__subheading">{{ block.settings.subheading }}</p>
                    {%- endif -%}
                    {%- if block.settings.heading != blank -%}
                      <h2 class="stack-banner__heading">{{ block.settings.heading }}</h2>
                    {%- endif -%}
                    {%- if block.settings.text != blank -%}
                      <div class="stack-banner__text">{{ block.settings.text }}</div>
                    {%- endif -%}
                    {%- if block.settings.link_label != blank and block.settings.link != blank -%}
                      <a href="{{ block.settings.link }}" class="button button--primary">
                        {{- block.settings.link_label -}}
                      </a>
                    {%- endif -%}
                  </div>
                </div>
              </div>
            </div>
        {% endcase %}
      {%- endfor -%}
    </div>
  </div>
  <div class="space"></div>
</div>

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .stack-banner {
    background-color: rgba(var(--color-foreground), 0.04);
    min-height: 100vh;
  }

  .stack-banner__cards {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 40px 0;
    box-sizing: border-box;
  }

  .stack-banner__card {
    position: sticky;
    top: {{ section.settings.sticky_top_mobile }}%;
    padding-top: 20px;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    border-radius: var(--media-radius);
    overflow: hidden;
    background: transparent !important;
  }

  @media screen and (min-width: 750px) {
    .stack-banner__card {
      top: {{ section.settings.sticky_top_desktop }}%;
    }
  }

  .stack-banner__card:nth-child(2) {
    padding-top: 40px;
  }

  .stack-banner__card:nth-child(3) {
    padding-top: 60px;
  }

  .stack-banner__card:nth-child(4) {
    padding-top: 80px;
  }

  .stack-banner__card:nth-child(5) {
    padding-top: 100px;
  }

  .stack-banner__card:nth-child(n+6) {
    padding-top: 120px;
  }

  .stack-banner__card-inner {
    will-change: transform;
    background: transparent !important;
    background-color: transparent !important;
    border-radius: var(--media-radius);
    display: flex;
    overflow: hidden;
    box-shadow: 0 25px 50px -12px rgba(var(--color-shadow), var(--text-boxes-shadow-opacity, 0.35));
    transform-origin: center top;
    margin: 0;
    padding: 0;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    border: none;
  }

  /* Scale cards as they scroll - using scroll-driven animations */
  .stack-banner__card:not(:last-child) .stack-banner__card-inner {
    animation: stackScale linear;
    animation-timeline: scroll();
    animation-range: entry 0% exit 100%;
  }

  @keyframes stackScale {
    from {
      transform: scale(1);
    }
    to {
      transform: scale(0.9);
    }
  }

  /* Last card stays at full scale */
  .stack-banner__card:last-child .stack-banner__card-inner {
    transform: scale(1);
  }

  /* Progressive initial scale for visual depth */
  .stack-banner__card:nth-last-child(2) .stack-banner__card-inner {
    transform: scale(0.95);
  }

  .stack-banner__card:nth-last-child(3) .stack-banner__card-inner {
    transform: scale(0.92);
  }

  .stack-banner__card:nth-last-child(4) .stack-banner__card-inner {
    transform: scale(0.9);
  }

  .stack-banner__card:nth-last-child(n+5) .stack-banner__card-inner {
    transform: scale(0.88);
  }

  .stack-banner__image-container {
    display: block;
    width: 100%;
    flex-shrink: 0;
    border-radius: var(--media-radius);
    overflow: hidden;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    line-height: 0;
    background: transparent;
  }

  .stack-banner__image,
  .stack-banner__image-container .placeholder-svg {
    width: 100%;
    height: 100%;
    object-fit: cover;
    aspect-ratio: 3 / 2;
    border-radius: var(--media-radius);
    display: block;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    vertical-align: top;
  }

  .stack-banner__image-container .placeholder-svg {
    width: 100%;
    height: auto;
  }

  .space {
    height: 90vh;
  }

  .space--small {
    height: 40vh;
  }

  @media screen and (max-width: 749px) {
    .stack-banner__image,
    .stack-banner__image-container .placeholder-svg {
      aspect-ratio: 2 / 3;
    }

    .stack-banner__cards {
      padding: 0 1.5rem;
    }
  }

  .stack-banner__content {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 2rem;
    color: #fff;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: flex-start;
    height: 100%;
    box-sizing: border-box;
    pointer-events: none; /* Let clicks pass through if the whole card is linked, but here we have a button so might need pointer-events auto on button */
  }

  .stack-banner__content > * {
      pointer-events: auto;
  }

  .stack-banner__subheading {
    font-size: 1.2rem;
    margin: 0 0 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .stack-banner__heading {
    font-size: 2.5rem;
    margin: 0 0 1rem;
    color: #fff;
  }

  .stack-banner__text {
    margin: 0 0 1.5rem;
    max-width: 600px;
  }

  .stack-banner__text p {
      color: #fff;
      margin: 0;
  }

  @media screen and (max-width: 749px) {
      .stack-banner__heading {
          font-size: 1.8rem;
      }
  }
{%- endstyle -%}

{% schema %}
{
  "name": "Stack Banner",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Sticky positioning"
    },
    {
      "type": "range",
      "id": "sticky_top_desktop",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Sticky top (desktop)",
      "default": 20,
      "info": "Distance from top of viewport when sticky on desktop (percentage)"
    },
    {
      "type": "range",
      "id": "sticky_top_mobile",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Sticky top (mobile)",
      "default": 15,
      "info": "Distance from top of viewport when sticky on mobile (percentage)"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "card",
      "name": "Card",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "Recommended size: 1200Ã—675px (16:9 aspect ratio)"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Card Heading"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading",
          "default": "Subheading"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Share information about your brand with your customers.</p>"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "text",
          "id": "link_label",
          "label": "Link label",
          "default": "Button"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Stack Banner",
      "blocks": [
        {
          "type": "card",
          "settings": {
            "image": ""
          }
        },
        {
          "type": "card",
          "settings": {
            "image": ""
          }
        },
        {
          "type": "card",
          "settings": {
            "image": ""
          }
        },
        {
          "type": "card",
          "settings": {
            "image": ""
          }
        }
      ]
    }
  ]
}
{% endschema %}
