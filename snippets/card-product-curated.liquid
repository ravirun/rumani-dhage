{% comment %}
  Saree Product Card - Clean Conversion Edition
  Exactly follows the user's provided static code but with Liquid data binding.
{% endcomment %}

{%- liquid
  assign main_variant = card_product.selected_or_first_available_variant | default: product.selected_or_first_available_variant
  assign current_price = main_variant.price | money | default: '₹10,999'
  assign old_price = main_variant.compare_at_price | money | default: '₹12,999'
  assign title = card_product.title | default: 'Froal Banarasi Saree Multi-color'
  assign fabric = card_product.metafields.custom.fabric | default: 'Pure Katan Silk • Hand-loomed in Varanasi'
  assign stock_count = main_variant.inventory_quantity | default: 3

  # Occasion Tag logic
  assign occasion = 'Wedding Choice'
  for tag in card_product.tags
    if tag contains 'Occasion:'
      assign occasion = tag | split: ':' | last
      break
    endif
  endfor

  # Discount calculation
  if main_variant.compare_at_price > main_variant.price
    assign discount = main_variant.compare_at_price | minus: main_variant.price | times: 100 | divided_by: main_variant.compare_at_price
  endif

  # EMI calculation
  assign emi_price = main_variant.price | divided_by: 3 | money
-%}

<style>
  .product-card-static {
    --bg-card: #f2f7f0;
    --primary-accent: #ac3451;
    --success: #2d5a27;
    --text-dark: #000000;
    --text-muted: #555555;
    --font-main: 'Inter', sans-serif;

    /* Mobile Default Sizing */
    --card-radius: 36px;
    --inner-radius: 28px;
    --title-size: 20px;
    --price-size: 18px;
    --btn-padding: 14px;

    background-color: var(--bg-card);
    border-radius: var(--card-radius);
    padding: 12px;
    display: flex;
    flex-direction: column;
    user-select: none;
    width: 100%;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    position: relative;
    text-align: left;
  }

  @media (min-width: 768px) {
    .product-card-static {
      --card-radius: 44px;
      --inner-radius: 36px;
      --title-size: 28px;
      --price-size: 24px;
      --btn-padding: 20px;
    }
  }

  .image-section-static {
    position: relative;
    width: 100%;
    border-radius: var(--inner-radius);
    overflow: hidden;
    aspect-ratio: 1 / 1.45;
    background: #e8ede6;
  }

  .image-slider-static {
    display: flex;
    height: 100%;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .image-slider-static::-webkit-scrollbar {
    display: none;
  }

  .product-img-static {
    flex: 0 0 100%;
    width: 100%;
    height: 100%;
    object-fit: cover;
    scroll-snap-align: start;
    transition: transform 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
  }

  @media (min-width: 768px) {
    .image-section-static:hover .product-img-static {
      transform: scale(1.08);
    }
  }

  .occasion-tag-static {
    position: absolute;
    top: 20px;
    right: 70px;
    background: rgba(255, 255, 255, 0.9);
    color: var(--text-dark);
    padding: 6px 12px;
    border-radius: 30px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    backdrop-filter: blur(4px);
    z-index: 10;
    pointer-events: none;
  }

  .dots-overlay-static {
    position: absolute;
    top: 25px;
    right: 25px;
    display: flex;
    gap: 6px;
    z-index: 10;
  }

  .dot-static {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    border: 1.5px solid rgba(255, 255, 255, 0.9);
    cursor: pointer;
    background: transparent;
    transition: all 0.2s;
  }
  .dot-static.active {
    background-color: var(--primary-accent);
    border-color: var(--primary-accent);
  }

  .content-static {
    padding: 20px 8px 10px;
  }

  .rating-row-static {
    display: flex;
    align-items: center;
    gap: 4px;
    margin-bottom: 8px;
    font-size: 14px;
    color: #fbbf24;
  }
  .review-count-static {
    color: var(--text-muted);
    margin-left: 4px;
    font-weight: 500;
  }

  .title-static {
    font-size: var(--title-size);
    font-weight: 700;
    line-height: 1.1;
    margin-bottom: 8px;
    letter-spacing: -0.5px;
    color: inherit;
    text-decoration: none;
    display: block;
  }

  .fabric-type-static {
    font-size: 14px;
    color: var(--text-muted);
    margin-bottom: 12px;
    display: block;
  }

  .stock-status-static {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .stock-low-static {
    color: #dc2626;
  }
  .stock-pulse-static {
    width: 8px;
    height: 8px;
    background: #dc2626;
    border-radius: 50%;
    position: relative;
  }
  .stock-pulse-static::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: inherit;
    border-radius: inherit;
    animation: pulse-static 1.5s infinite;
  }

  @keyframes pulse-static {
    0% {
      transform: scale(1);
      opacity: 1;
    }
    100% {
      transform: scale(2.5);
      opacity: 0;
    }
  }

  .price-container-static {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 4px;
  }
  .current-price-static {
    font-size: var(--price-size);
    font-weight: 700;
  }
  .old-price-static {
    font-size: calc(var(--price-size) * 0.8);
    color: var(--text-muted);
    text-decoration: line-through;
  }
  .discount-tag-static {
    background: #fef2f2;
    color: #ef4444;
    padding: 2px 8px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 700;
  }

  .emi-text-static {
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 24px;
  }
  .emi-text-static b {
    color: var(--text-dark);
  }

  .action-row-static {
    display: grid;
    grid-template-columns: 1fr 50px;
    gap: 10px;
    margin-bottom: 20px;
  }

  .add-btn-static {
    background-color: var(--primary-accent);
    color: white;
    border: none;
    padding: var(--btn-padding);
    border-radius: 20px;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 8px 16px rgba(172, 52, 81, 0.2);
  }
  .add-btn-static:hover {
    background-color: #962d46;
    transform: translateY(-2px);
  }
  .add-btn-static:active {
    transform: scale(0.98);
  }

  .wa-btn-static {
    background: #25d366;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    border: none;
    cursor: pointer;
    transition: 0.2s;
  }
  .wa-btn-static:hover {
    background: #1eb956;
  }

  .benefit-bar-static {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    border-top: 1px solid #e5e7eb;
    padding-top: 15px;
  }
  .benefit-item-static {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    font-weight: 600;
    color: var(--text-muted);
  }
  .benefit-item-static svg {
    color: var(--success);
    flex-shrink: 0;
  }
</style>

<div class="product-card-static" id="Card-{{ card_product.id }}-{{ section_id }}">
  <div class="image-section-static">
    <div class="occasion-tag-static">{{ occasion }}</div>

    <div class="image-slider-static">
      {%- if card_product.media.size > 0 -%}
        {%- for media in card_product.media limit: 3 -%}
          <img
            src="{{ media | image_url: width: 800 }}"
            class="product-img-static"
            alt="{{ media.alt | escape }}"
            loading="lazy"
            width="{{ media.width }}"
            height="{{ media.height }}"
          >
        {%- endfor -%}
      {%- else -%}
        {{ 'product-1' | placeholder_svg_tag: 'product-img-static' }}
      {%- endif -%}
    </div>

    <div class="dots-overlay-static">
      {%- if card_product.media.size > 1 -%}
        {%- for media in card_product.media limit: 3 -%}
          <div class="dot-static {% if forloop.first %}active{% endif %}"></div>
        {%- endfor -%}
      {%- else -%}
        <div class="dot-static active"></div>
        <div class="dot-static"></div>
        <div class="dot-static"></div>
      {%- endif -%}
    </div>
  </div>

  <div class="content-static">
    <div class="rating-row-static">★★★★★ <span class="review-count-static">(124 Reviews)</span></div>

    <a href="{{ card_product.url }}" class="title-static">{{ title }}</a>
    <span class="fabric-type-static">{{ fabric }}</span>

    {%- if main_variant.available and stock_count > 0 and stock_count < 10 -%}
      <div class="stock-status-static stock-low-static">
        <div class="stock-pulse-static"></div>
        Limited Stock - {{ stock_count }} pieces left
      </div>
    {%- else -%}
      <div class="stock-status-static" style="color: var(--success)">In Stock - Handcrafted for You</div>
    {%- endif -%}

    <div class="price-container-static">
      <span class="current-price-static">{{ current_price }}</span>
      {%- if main_variant.compare_at_price > main_variant.price -%}
        <span class="old-price-static">{{ old_price }}</span>
        <span class="discount-tag-static">{{ discount }}% OFF</span>
      {%- endif -%}
    </div>

    <p class="emi-text-static">
      Or 3 monthly payments of <b>{{ emi_price }}</b> with 0% interest
    </p>

    <div class="action-row-static">
      {%- if card_product.available -%}
        <product-form data-section-id="{{ section_id }}">
          {%- form 'product',
            card_product,
            id: product_form_id,
            class: 'form',
            novalidate: 'novalidate',
            data-type: 'add-to-cart-form'
          -%}
            <input type="hidden" name="id" value="{{ main_variant.id }}">
            <button type="submit" name="add" class="add-btn-static cart-btn">Add To Cart</button>
          {%- endform -%}
        </product-form>
      {%- else -%}
        <button class="add-btn-static" disabled>Sold Out</button>
      {%- endif -%}

      <button
        class="wa-btn-static"
        title="Ask on WhatsApp"
        onclick="window.open('https://wa.me/+919876543210?text=Namaste! I am interested in the {{ title | escape }}. {{ shop.url }}{{ card_product.url }}', '_blank')"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.672 1.433 5.663 1.434h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
        </svg>
      </button>
    </div>

    <div class="benefit-bar-static">
      <div class="benefit-item-static">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
          <path d="M20 6L9 17l-5-5"/>
        </svg>
        Silk Mark Certified
      </div>
      <div class="benefit-item-static">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
          <path d="M20 6L9 17l-5-5"/>
        </svg>
        Easy 7-Day Returns
      </div>
    </div>
  </div>
</div>

<script>
  (function () {
    const card = document.getElementById('Card-{{ card_product.id }}-{{ section_id }}');
    if (!card) return;

    const slider = card.querySelector('.image-slider-static');
    const dots = card.querySelectorAll('.dot-static');

    if (slider) {
      slider.addEventListener('scroll', () => {
        const index = Math.round(slider.scrollLeft / slider.offsetWidth);
        dots.forEach((d, i) => d.classList.toggle('active', i === index));
      });
    }

    dots.forEach((dot, i) => {
      dot.onclick = () => slider.scrollTo({ left: i * slider.offsetWidth, behavior: 'smooth' });
    });

    const cartBtn = card.querySelector('.cart-btn');
    if (cartBtn) {
      cartBtn.onclick = function () {
        const txt = this.innerText;
        this.innerText = '✓ Adding...';
        // The actual form submission is handled by product-form.js
        setTimeout(() => {
          this.innerText = '✓ In Cart';
          this.style.backgroundColor = 'var(--success)';
        }, 800);
      };
    }
  })();
</script>
