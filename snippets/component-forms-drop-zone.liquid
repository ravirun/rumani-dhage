{% comment %}
  DropZone Component
  Lets users upload files through drag-and-drop functionality into a designated area on a page, or by activating a button.
  
  @param {string} name - Input name attribute (required)
  @param {string} id - Input ID attribute (optional)
  @param {string} label - Label text (optional)
  @param {string} accept - Accepted file types (optional, e.g., 'image/*')
  @param {boolean} multiple - Allow multiple files (default: false)
  @param {boolean} required - Mark as required (default: false)
  @param {boolean} disabled - Disable input (default: false)
  @param {string} error - Error message (optional)
  @param {string} help - Help text (optional)
  @param {string} class - Additional CSS classes
  @param {string} attributes - Additional HTML attributes
  
  @example
  {% render 'component-forms-drop-zone', name: 'files', label: 'Upload files', accept: 'image/*', multiple: true %}
{% endcomment %}

{% liquid
  assign name = name | default: ''
  assign id = id | default: name
  assign label = label | default: ''
  assign accept = accept | default: ''
  assign multiple = multiple | default: false
  assign required = required | default: false
  assign disabled = disabled | default: false
  assign error = error | default: ''
  assign help = help | default: ''
  assign class = class | default: ''
  assign attributes = attributes | default: ''
  
  unless name != blank
    echo '<!-- Error: name parameter required for drop-zone component -->'
    break
  endunless
%}

<div class="ds-drop-zone {{ class }}" data-drop-zone>
  {% if label != blank %}
    <label for="{{ id }}" class="ds-drop-zone__label">
      {{ label }}
      {% if required %}<span class="ds-drop-zone__required" aria-label="required">*</span>{% endif %}
    </label>
  {% endif %}
  
  <div class="ds-drop-zone__area" data-drop-area>
    <input
      type="file"
      id="{{ id }}"
      name="{{ name }}"
      class="ds-drop-zone__input"
      {% if accept != blank %}accept="{{ accept }}"{% endif %}
      {% if multiple %}multiple{% endif %}
      {% if required %}required{% endif %}
      {% if disabled %}disabled{% endif %}
      {{ attributes }}
    >
    <div class="ds-drop-zone__content">
      <i data-lucide="upload" class="ds-drop-zone__icon"></i>
      <p class="ds-drop-zone__text">Drag and drop files here or click to browse</p>
      <p class="ds-drop-zone__hint">Select files to upload</p>
    </div>
  </div>
  
  <div class="ds-drop-zone__files" data-files-list style="display: none;"></div>
  
  {% if error != blank %}
    <span class="ds-drop-zone__error" role="alert">{{ error }}</span>
  {% endif %}
  
  {% if help != blank and error == blank %}
    <span class="ds-drop-zone__help">{{ help }}</span>
  {% endif %}
</div>

{% stylesheet %}
  .ds-drop-zone {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
  }
  
  .ds-drop-zone__label {
    font-size: var(--font-size-sm);
    font-weight: var(--font-primary--weight);
    color: var(--color-foreground);
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
  }
  
  .ds-drop-zone__required {
    color: var(--color-error);
  }
  
  .ds-drop-zone__area {
    position: relative;
    border: 2px dashed var(--color-border);
    border-radius: var(--card-border-radius);
    padding: var(--spacing-xl);
    text-align: center;
    background-color: var(--color-background);
    transition: var(--transition);
    cursor: pointer;
  }
  
  .ds-drop-zone__area:hover {
    border-color: var(--color-primary);
    background-color: color-mix(in srgb, var(--color-primary) 5%, transparent);
  }
  
  .ds-drop-zone__area.ds-drop-zone__area--dragover {
    border-color: var(--color-primary);
    background-color: color-mix(in srgb, var(--color-primary) 10%, transparent);
  }
  
  .ds-drop-zone__input {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    opacity: 0;
    cursor: pointer;
  }
  
  .ds-drop-zone__content {
    pointer-events: none;
  }
  
  .ds-drop-zone__icon {
    width: 3rem;
    height: 3rem;
    color: var(--color-primary);
    margin: 0 auto var(--spacing-md);
  }
  
  .ds-drop-zone__text {
    font-size: var(--font-size-base);
    font-weight: var(--font-primary--weight);
    color: var(--color-foreground);
    margin: 0 0 var(--spacing-xs) 0;
  }
  
  .ds-drop-zone__hint {
    font-size: var(--font-size-sm);
    color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
    margin: 0;
  }
  
  .ds-drop-zone__files {
    margin-top: var(--spacing-md);
  }
  
  .ds-drop-zone__file-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm);
    background-color: var(--color-secondary);
    border-radius: var(--input-border-radius);
    margin-bottom: var(--spacing-xs);
  }
  
  .ds-drop-zone__file-name {
    flex: 1;
    font-size: var(--font-size-sm);
    color: var(--color-foreground);
  }
  
  .ds-drop-zone__file-remove {
    background: none;
    border: none;
    padding: 0.25rem;
    cursor: pointer;
    color: var(--color-error);
    display: flex;
    align-items: center;
  }
  
  .ds-drop-zone__error {
    font-size: var(--font-size-sm);
    color: var(--color-error);
    display: block;
  }
  
  .ds-drop-zone__help {
    font-size: var(--font-size-sm);
    color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
    display: block;
  }
{% endstylesheet %}

{% javascript %}
  (function() {
    const dropZones = document.querySelectorAll('[data-drop-zone]');
    
    dropZones.forEach(zone => {
      const input = zone.querySelector('input[type="file"]');
      const area = zone.querySelector('[data-drop-area]');
      const filesList = zone.querySelector('[data-files-list]');
      
      if (!input || !area) return;
      
      // Drag and drop handlers
      area.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('ds-drop-zone__area--dragover');
      });
      
      area.addEventListener('dragleave', function(e) {
        e.preventDefault();
        this.classList.remove('ds-drop-zone__area--dragover');
      });
      
      area.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('ds-drop-zone__area--dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          input.files = files;
          updateFilesList(zone, files);
        }
      });
      
      // File input change
      input.addEventListener('change', function() {
        if (this.files.length > 0) {
          updateFilesList(zone, this.files);
        }
      });
      
      function updateFilesList(zone, files) {
        const list = zone.querySelector('[data-files-list]');
        if (!list) return;
        
        list.innerHTML = '';
        list.style.display = 'block';
        
        Array.from(files).forEach((file, index) => {
          const item = document.createElement('div');
          item.className = 'ds-drop-zone__file-item';
          item.innerHTML = `
            <span class="ds-drop-zone__file-name">${file.name}</span>
            <button type="button" class="ds-drop-zone__file-remove" data-remove-file="${index}">
              <i data-lucide="x" class="ds-drop-zone__remove-icon"></i>
            </button>
          `;
          list.appendChild(item);
        });
        
        // Remove file handlers
        list.querySelectorAll('[data-remove-file]').forEach(btn => {
          btn.addEventListener('click', function() {
            const index = parseInt(this.getAttribute('data-remove-file'));
            const dt = new DataTransfer();
            Array.from(input.files).forEach((file, i) => {
              if (i !== index) dt.items.add(file);
            });
            input.files = dt.files;
            updateFilesList(zone, input.files);
          });
        });
        
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
        }
      }
    });
    
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }
  })();
{% endjavascript %}

