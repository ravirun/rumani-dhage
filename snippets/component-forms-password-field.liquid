{% comment %}
  PasswordField Component
  Securely collect sensitive information from users.
  
  @param {string} name - Input name attribute (required)
  @param {string} id - Input ID attribute (optional)
  @param {string} value - Input value (optional)
  @param {string} placeholder - Placeholder text (optional)
  @param {string} label - Label text (optional)
  @param {boolean} required - Mark as required (default: false)
  @param {boolean} disabled - Disable input (default: false)
  @param {boolean} show_toggle - Show password visibility toggle (default: true)
  @param {string} error - Error message (optional)
  @param {string} help - Help text (optional)
  @param {string} class - Additional CSS classes
  @param {string} attributes - Additional HTML attributes
  
  @example
  {% render 'component-forms-password-field', name: 'password', label: 'Password', required: true %}
{% endcomment %}

{% liquid
  assign name = name | default: ''
  assign id = id | default: name
  assign value = value | default: ''
  assign placeholder = placeholder | default: ''
  assign label = label | default: ''
  assign required = required | default: false
  assign disabled = disabled | default: false
  assign show_toggle = show_toggle | default: true
  assign error = error | default: ''
  assign help = help | default: ''
  assign class = class | default: ''
  assign attributes = attributes | default: ''
  
  unless name != blank
    echo '<!-- Error: name parameter required for password-field component -->'
    break
  endunless
  
  assign toggle_id = id | append: '-toggle'
%}

<div class="ds-password-field {{ class }}">
  {% if label != blank %}
    <label for="{{ id }}" class="ds-password-field__label">
      {{ label }}
      {% if required %}<span class="ds-password-field__required" aria-label="required">*</span>{% endif %}
    </label>
  {% endif %}
  
  <div class="ds-password-field__wrapper">
    <input
      type="password"
      id="{{ id }}"
      name="{{ name }}"
      value="{{ value }}"
      placeholder="{{ placeholder }}"
      class="ds-input ds-password-field__input {% if error != blank %}ds-password-field__input--error{% endif %}"
      {% if required %}required{% endif %}
      {% if disabled %}disabled{% endif %}
      {{ attributes }}
    >
    {% if show_toggle %}
      <button
        type="button"
        class="ds-password-field__toggle"
        id="{{ toggle_id }}"
        aria-label="Toggle password visibility"
        data-password-toggle
      >
        <i data-lucide="eye" class="ds-password-field__toggle-icon"></i>
      </button>
    {% endif %}
  </div>
  
  {% if error != blank %}
    <span class="ds-password-field__error" role="alert">{{ error }}</span>
  {% endif %}
  
  {% if help != blank and error == blank %}
    <span class="ds-password-field__help">{{ help }}</span>
  {% endif %}
</div>

{% stylesheet %}
  .ds-password-field {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
  }
  
  .ds-password-field__label {
    font-size: var(--font-size-sm);
    font-weight: var(--font-primary--weight);
    color: var(--color-foreground);
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
  }
  
  .ds-password-field__required {
    color: var(--color-error);
  }
  
  .ds-password-field__wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }
  
  .ds-password-field__input {
    width: 100%;
    padding-right: calc(var(--input-padding-horizontal) + 2rem);
  }
  
  .ds-password-field__input--error {
    border-color: var(--color-error);
  }
  
  .ds-password-field__input--error:focus {
    border-color: var(--color-error);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-error) 20%, transparent);
  }
  
  .ds-password-field__toggle {
    position: absolute;
    right: var(--input-padding-horizontal);
    background: none;
    border: none;
    padding: 0.25rem;
    cursor: pointer;
    color: var(--color-foreground);
    opacity: 0.6;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .ds-password-field__toggle:hover {
    opacity: 1;
  }
  
  .ds-password-field__toggle-icon {
    width: 1.25rem;
    height: 1.25rem;
  }
  
  .ds-password-field__error {
    font-size: var(--font-size-sm);
    color: var(--color-error);
    display: block;
  }
  
  .ds-password-field__help {
    font-size: var(--font-size-sm);
    color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
    display: block;
  }
{% endstylesheet %}

{% javascript %}
  (function() {
    const toggles = document.querySelectorAll('[data-password-toggle]');
    
    toggles.forEach(toggle => {
      toggle.addEventListener('click', function() {
        const input = this.parentElement.querySelector('input[type="password"], input[type="text"]');
        const icon = this.querySelector('i');
        
        if (input.type === 'password') {
          input.type = 'text';
          icon.setAttribute('data-lucide', 'eye-off');
        } else {
          input.type = 'password';
          icon.setAttribute('data-lucide', 'eye');
        }
        
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
        }
      });
    });
    
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }
  })();
{% endjavascript %}

