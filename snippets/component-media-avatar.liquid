{% comment %}
  Avatar Component
  Show a user's profile image or initials in a compact, visual element.
  
  @param {image} image - Avatar image (optional)
  @param {string} name - Name for initials (optional)
  @param {string} size - Avatar size: xs, sm, md, lg, xl (default: md)
  @param {string} shape - Avatar shape: circle, square (default: circle)
  @param {string} class - Additional CSS classes
  @param {string} attributes - Additional HTML attributes
  
  @example
  {% render 'component-media-avatar', name: 'John Doe', size: 'lg' %}
  {% render 'component-media-avatar', image: customer.avatar, name: customer.name %}
{% endcomment %}

{% liquid
  assign image = image | default: empty
  assign name = name | default: ''
  assign size = size | default: 'md'
  assign shape = shape | default: 'circle'
  assign class = class | default: ''
  assign attributes = attributes | default: ''
  
  if name != blank
    assign initials = name | split: ' ' | map: 'first' | join: '' | truncate: 2, ''
  endif
%}

<div 
  class="ds-avatar ds-avatar--{{ size }} ds-avatar--{{ shape }} {{ class }}"
  {{ attributes }}
>
  {% if image != empty %}
    {% liquid
      assign avatar_size = 200
      case size
        when 'xs'
          assign avatar_size = 24
        when 'sm'
          assign avatar_size = 32
        when 'md'
          assign avatar_size = 40
        when 'lg'
          assign avatar_size = 56
        when 'xl'
          assign avatar_size = 80
      endcase
    %}
    <img 
      src="{{ image | image_url: width: avatar_size }}"
      alt="{{ name | default: 'Avatar' }}"
      class="ds-avatar__image"
      loading="lazy"
      width="{{ avatar_size }}"
      height="{{ avatar_size }}"
    >
  {% elsif initials != blank %}
    <span class="ds-avatar__initials">{{ initials }}</span>
  {% else %}
    <i data-lucide="user" class="ds-avatar__icon"></i>
  {% endif %}
</div>

{% stylesheet %}
  .ds-avatar {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-secondary);
    color: var(--color-secondary-text);
    overflow: hidden;
    flex-shrink: 0;
  }
  
  .ds-avatar--xs {
    width: 1.5rem;
    height: 1.5rem;
    font-size: var(--font-size-xs);
  }
  
  .ds-avatar--sm {
    width: 2rem;
    height: 2rem;
    font-size: var(--font-size-sm);
  }
  
  .ds-avatar--md {
    width: 2.5rem;
    height: 2.5rem;
    font-size: var(--font-size-base);
  }
  
  .ds-avatar--lg {
    width: 3.5rem;
    height: 3.5rem;
    font-size: var(--font-size-lg);
  }
  
  .ds-avatar--xl {
    width: 5rem;
    height: 5rem;
    font-size: var(--font-size-xl);
  }
  
  .ds-avatar--circle {
    border-radius: 50%;
  }
  
  .ds-avatar--square {
    border-radius: var(--card-border-radius);
  }
  
  .ds-avatar__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .ds-avatar__initials {
    font-weight: calc(var(--font-primary--weight) + 200);
    text-transform: uppercase;
    line-height: 1;
  }
  
  .ds-avatar__icon {
    width: 60%;
    height: 60%;
    opacity: 0.7;
  }
{% endstylesheet %}

{% javascript %}
  (function() {
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }
  })();
{% endjavascript %}

