{% comment %}
  Modal Component
  Displays content in an overlay.
  
  @param {string} id - Modal ID (required)
  @param {string} title - Modal title (optional)
  @param {string} content - Modal content (required)
  @param {boolean} open - Initial open state (default: false)
  @param {string} size - Modal size: sm, md, lg, xl, full (default: md)
  @param {boolean} close_on_overlay - Close on overlay click (default: true)
  @param {boolean} show_close - Show close button (default: true)
  @param {string} class - Additional CSS classes
  @param {string} attributes - Additional HTML attributes
  
  @example
  {% render 'component-overlays-modal', id: 'my-modal', title: 'Modal Title', content: 'Modal content here' %}
{% endcomment %}

{% liquid
  assign id = id | default: ''
  assign title = title | default: ''
  assign content = content | default: ''
  assign open = open | default: false
  assign size = size | default: 'md'
  assign close_on_overlay = close_on_overlay | default: true
  assign show_close = show_close | default: true
  assign class = class | default: ''
  assign attributes = attributes | default: ''
  
  unless id != blank
    echo '<!-- Error: id parameter required for modal component -->'
    break
  endunless
%}

<div 
  class="ds-modal {% if open %}ds-modal--open{% endif %} {{ class }}"
  id="{{ id }}"
  role="dialog"
  aria-modal="true"
  aria-labelledby="{{ id }}-title"
  {{ attributes }}
>
  <div class="ds-modal__overlay" {% if close_on_overlay %}data-modal-close{% endif %}></div>
  <div class="ds-modal__content ds-modal__content--{{ size }}">
    {% if title != blank or show_close %}
      <div class="ds-modal__header">
        {% if title != blank %}
          <h2 id="{{ id }}-title" class="ds-modal__title">{{ title }}</h2>
        {% endif %}
        {% if show_close %}
          <button 
            type="button"
            class="ds-modal__close"
            aria-label="Close modal"
            data-modal-close
          >
            <i data-lucide="x" class="ds-modal__close-icon"></i>
          </button>
        {% endif %}
      </div>
    {% endif %}
    <div class="ds-modal__body">
      {{ content }}
    </div>
  </div>
</div>

{% stylesheet %}
  body.ds-modal-open {
    overflow: hidden;
  }
  
  .ds-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    pointer-events: none;
  }
  
  .ds-modal--open {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }
  
  .ds-modal__overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(2px);
  }
  
  .ds-modal__content {
    position: relative;
    background-color: var(--color-background);
    border-radius: var(--card-border-radius);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-height: 90vh;
    max-width: 90vw;
    display: flex;
    flex-direction: column;
    transform: scale(0.95);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
  }
  
  .ds-modal--open .ds-modal__content {
    transform: scale(1);
  }
  
  .ds-modal__content--sm {
    width: 100%;
    max-width: 24rem;
  }
  
  .ds-modal__content--md {
    width: 100%;
    max-width: 32rem;
  }
  
  .ds-modal__content--lg {
    width: 100%;
    max-width: 48rem;
  }
  
  .ds-modal__content--xl {
    width: 100%;
    max-width: 64rem;
  }
  
  .ds-modal__content--full {
    width: 100%;
    height: 100%;
    max-width: 100vw;
    max-height: 100vh;
    border-radius: 0;
  }
  
  .ds-modal__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-lg);
    border-bottom: 1px solid var(--color-border);
    flex-shrink: 0;
  }
  
  .ds-modal__title {
    margin: 0;
    font-size: var(--font-size-xl);
    font-weight: var(--font-primary--weight);
    color: var(--color-foreground);
  }
  
  .ds-modal__close {
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--color-foreground);
    opacity: 0.7;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .ds-modal__close:hover {
    opacity: 1;
  }
  
  .ds-modal__close-icon {
    width: 1.5rem;
    height: 1.5rem;
  }
  
  .ds-modal__body {
    padding: var(--spacing-lg);
    overflow-y: auto;
    flex: 1;
    -webkit-overflow-scrolling: touch;
  }
{% endstylesheet %}

{% javascript %}
  (function() {
    // Initialize Lucide icons
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }
    
    // Modal open/close functionality
    const modals = document.querySelectorAll('.ds-modal');
    const body = document.body;
    
    function openModal(modal) {
      if (!modal) return;
      body.classList.add('ds-modal-open');
      modal.classList.add('ds-modal--open');
      
      // Prevent body scroll
      const scrollY = window.scrollY;
      body.style.position = 'fixed';
      body.style.top = `-${scrollY}px`;
      body.style.width = '100%';
      
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    }
    
    function closeModal(modal) {
      if (!modal) return;
      const scrollY = body.style.top;
      body.classList.remove('ds-modal-open');
      body.style.position = '';
      body.style.top = '';
      body.style.width = '';
      
      if (scrollY) {
        window.scrollTo(0, parseInt(scrollY || '0') * -1);
      }
      
      modal.classList.remove('ds-modal--open');
    }
    
    // Close buttons and overlay
    modals.forEach(modal => {
      const closeButtons = modal.querySelectorAll('[data-modal-close]');
      closeButtons.forEach(button => {
        button.addEventListener('click', function() {
          closeModal(modal);
        });
      });
      
      // Close on escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('ds-modal--open')) {
          closeModal(modal);
        }
      });
    });
    
    // Expose modal functions globally
    window.dsModal = {
      open: function(modalId) {
        const modal = document.getElementById(modalId);
        openModal(modal);
      },
      close: function(modalId) {
        const modal = document.getElementById(modalId);
        closeModal(modal);
      }
    };
  })();
{% endjavascript %}

